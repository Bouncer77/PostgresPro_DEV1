# Практика

<!-- MarkdownTOC autolink="true" -->

- [1. Создайте новую базу данных и подключитесь к ней](#1-%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%B9%D1%82%D0%B5-%D0%BD%D0%BE%D0%B2%D1%83%D1%8E-%D0%B1%D0%B0%D0%B7%D1%83-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-%D0%B8-%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B8%D1%82%D0%B5%D1%81%D1%8C-%D0%BA-%D0%BD%D0%B5%D0%B9)
- [2. Создайте схему, названную так же, как и пользователь](#2-%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%B9%D1%82%D0%B5-%D1%81%D1%85%D0%B5%D0%BC%D1%83-%D0%BD%D0%B0%D0%B7%D0%B2%D0%B0%D0%BD%D0%BD%D1%83%D1%8E-%D1%82%D0%B0%D0%BA-%D0%B6%D0%B5-%D0%BA%D0%B0%D0%BA-%D0%B8-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C)
- [3. Создайте схему app](#3-%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%B9%D1%82%D0%B5-%D1%81%D1%85%D0%B5%D0%BC%D1%83-app)
- [4. Создайте несколько таблиц в обоих схемах](#4-%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%B9%D1%82%D0%B5-%D0%BD%D0%B5%D1%81%D0%BA%D0%BE%D0%BB%D1%8C%D0%BA%D0%BE-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86-%D0%B2-%D0%BE%D0%B1%D0%BE%D0%B8%D1%85-%D1%81%D1%85%D0%B5%D0%BC%D0%B0%D1%85)
- [5. Получите в psql описание созданных схем и список всех таблиц в них](#5-%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D0%B5-%D0%B2-psql-%D0%BE%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5-%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-%D1%81%D1%85%D0%B5%D0%BC-%D0%B8-%D1%81%D0%BF%D0%B8%D1%81%D0%BE%D0%BA-%D0%B2%D1%81%D0%B5%D1%85-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86-%D0%B2-%D0%BD%D0%B8%D1%85)
- [6. Установите путь поиска так, чтобы при подключение к БД таблицы из обоих схем были доступны по неквалифицированному имени; приоритет должна иметь "пользовательская" схема](#6-%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%B8%D1%82%D0%B5-%D0%BF%D1%83%D1%82%D1%8C-%D0%BF%D0%BE%D0%B8%D1%81%D0%BA%D0%B0-%D1%82%D0%B0%D0%BA-%D1%87%D1%82%D0%BE%D0%B1%D1%8B-%D0%BF%D1%80%D0%B8-%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BA-%D0%91%D0%94-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D1%8B-%D0%B8%D0%B7-%D0%BE%D0%B1%D0%BE%D0%B8%D1%85-%D1%81%D1%85%D0%B5%D0%BC-%D0%B1%D1%8B%D0%BB%D0%B8-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BD%D1%8B-%D0%BF%D0%BE-%D0%BD%D0%B5%D0%BA%D0%B2%D0%B0%D0%BB%D0%B8%D1%84%D0%B8%D1%86%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D0%BE%D0%BC%D1%83-%D0%B8%D0%BC%D0%B5%D0%BD%D0%B8-%D0%BF%D1%80%D0%B8%D0%BE%D1%80%D0%B8%D1%82%D0%B5%D1%82-%D0%B4%D0%BE%D0%BB%D0%B6%D0%BD%D0%B0-%D0%B8%D0%BC%D0%B5%D1%82%D1%8C-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D1%81%D0%BA%D0%B0%D1%8F-%D1%81%D1%85%D0%B5%D0%BC%D0%B0)
- [7. Проверьте правильность настройки](#7-%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D1%8C%D1%82%D0%B5-%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D1%8C-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B8)

<!-- /MarkdownTOC -->

### 1. Создайте новую базу данных и подключитесь к ней

Cоздадим базу данных с именем test

```sql
CREATE DATABASE test;
```

Убедимся, что база данных была успешно создана

```sql
\l
```

	                                                                        Список баз данных
	             Имя             |        Владелец        | Кодировка |     LC_COLLATE      |      LC_CTYPE       |                   Права доступа
	-----------------------------+------------------------+-----------+---------------------+---------------------+-------------------------------------
	 postgres                    | postgres               | UTF8      | Russian_Russia.1251 | Russian_Russia.1251 |
	 template0                   | postgres               | UTF8      | Russian_Russia.1251 | Russian_Russia.1251 | =c/postgres                                      +
	                             |                        |           |                     |                     | postgres=CTc/postgres
	 template1                   | postgres               | UTF8      | Russian_Russia.1251 | Russian_Russia.1251 | =c/postgres                                      +
	                             |                        |           |                     |                     | postgres=CTc/postgres
	 test                        | postgres               | UTF8      | Russian_Russia.1251 | Russian_Russia.1251 |
	(4 строк)

### 2. Создайте схему, названную так же, как и пользователь

Имя моего пользователя - postgres

Подключиться к базе данных (от слова \с - connect - подключиться)

```sql
\c test
```

	Вы подключены к базе данных "test" как пользователь "postgres".

```sql
\dn
```

	    Список схем
	  Имя   | Владелец
	--------+----------
	 public | postgres
	(1 строка)

Создадим схему с именем postgres (В моем случае postgres это имя пользователя)

```sql
CREATE SCHEMA postgres;
```

	CREATE SCHEMA

### 3. Создайте схему app	

```sql
CREATE SCHEMA app;
```
	CREATE SCHEMA

Выведем список схем в базе данных test

```sql
\dn
```

	     Список схем
	   Имя    | Владелец
	----------+----------
	 app      | postgres
	 postgres | postgres
	 public   | postgres
	(3 строки)

### 4. Создайте несколько таблиц в обоих схемах

	Для того чтобы создать таблицу в схеме postgres изменим путь поиска (переменная `search_path`)  
	Альтернативный вариант - можно указывать <имя_схемы>.<имя_таблицы>  

	Если не задать `search_path`, то по умолчанию, например, при выполнение оператора SQL для создания таблицы в схеме, таблица  
	будет создана в схеме public. public схема это схема по умолчанию, поэтому при обращение к таблице в ней не надо писать <имя_схемы>.<имя_таблицы>,  
	а достаточно просто указать <имя_таблицы>.

	В переменную seach_path можно задать несколько схем через запятую. Причем при обращение будет приоритет у схемы указанной первой при перечесление. Ниже рассмотрим это на примере. 

Изменим путь поиска (переменная `search_path`) для поиска в схеме postgres

```sql
SET search_path = postgres; -- по умолчанию search_path = public
```

	SET

Убедимся что переменная `search_path` была изменена

```sql
SHOW search_path;
```

	 search_path
	-------------
	 postgres
	(1 строка)

Создадим в схеме postgres таблицу ps1 с полем id целочисленного типа, который является первичным ключем

```sql
CREATE TABLE ps1(id int PRIMARY KEY);

-- Если search_path по уполчанию (search_path = public), то таблица создасться в схеме public
-- Чтобы создать таблицу в схеме postgres надо воспользоваться синтаксисом <имя_схемы>.<имя_таблицы>
-- CREATE TABLE postgres.ps1(id int PRIMARY KEY);
```

	CREATE TABLE

```sql
CREATE TABLE ps2(id int PRIMARY KEY);
```

	CREATE TABLE

Выведем список таблиц в схеме postgres

```sql
\dt
```

	          Список отношений
	  Схема   | Имя |   Тип   | Владелец
	----------+-----+---------+----------
	 postgres | ps1 | таблица | postgres
	 postgres | ps2 | таблица | postgres
	(2 строки)

Изменим путь поиска (переменная `search_path`) для поиска в схеме app

```sql
SET search_path = app;
```

	SET

Убедимся, что путь был изменен

```sql
SHOW search_path;
```

	 search_path
	-------------
	 app
	(1 строка)

Создадим в схеме app таблицу ap1 с полем id целочисленного типа, который является первичным ключем

```sql
CREATE TABLE ap1(id int PRIMARY KEY);
```

	CREATE TABLE

```sql
CREATE TABLE ap2(id int PRIMARY KEY);
```

	CREATE TABLE

Выведем список таблиц в схеме app	

```sql
\dt
```

	         Список отношений
	 Схема | Имя |   Тип   | Владелец
	-------+-----+---------+----------
	 app   | ap1 | таблица | postgres
	 app   | ap2 | таблица | postgres
	(2 строки)

### 5. Получите в psql описание созданных схем и список всех таблиц в них

Выведем список схем в базе данных test

```sql
\dn
```

	     Список схем
	   Имя    | Владелец
	----------+----------
	 app      | postgres
	 postgres | postgres
	 public   | postgres
	(3 строки)

Выведем список таблиц в схеме app

```sql
\dt
```

	         Список отношений
	 Схема | Имя |   Тип   | Владелец
	-------+-----+---------+----------
	 app   | ap1 | таблица | postgres
	 app   | ap2 | таблица | postgres
	(2 строки)

Выведем список таблиц в схеме postgres

```sql
\dt postgres.*
```

	          Список отношений
	  Схема   | Имя |   Тип   | Владелец
	----------+-----+---------+----------
	 postgres | ps1 | таблица | postgres
	 postgres | ps2 | таблица | postgres
	(2 строки)

### 6. Установите путь поиска так, чтобы при подключение к БД таблицы из обоих схем были доступны по неквалифицированному имени; приоритет должна иметь "пользовательская" схема

Команда позволяет при последующем подключение к базе данных test устанавливать значение переменной search_path = postgres, app;  
Схемы перечисляются через запятую в порядке убывания приоритета.

```sql
ALTER DATABASE test SET search_path = postgres, app;
```

	ALTER DATABASE

Обратите внимание, что значение переменной search_path не равно postgres, app. Это потому что мы не делали повторное подключение к базе данных test.

```sql 
SHOW search_path;
```

	 search_path
	-------------
	 app
	(1 строка)

Подключемся к базе данных по умолчанию (с именем postgres)

```sql
\c postgres
```

	Вы подключены к базе данных "postgres" как пользователь "postgres".

Заново подключимся к базе данных test

```sql
\c test
```

	Вы подключены к базе данных "test" как пользователь "postgres".

Проверим значение переменной search_path

```sql
SHOW search_path;
```

	  search_path
	---------------
	 postgres, app
	(1 строка)

### 7. Проверьте правильность настройки

Выведем содержимое таблиц и их заголовки из схем postgres и app в базе данных test

```sql
SELECT * FROM ps1;
```

	 id
	----
	(0 строк)

```sql
SELECT * FROM ps2;
```

	 id
	----
	(0 строк)

```sql
SELECT * FROM ap1;
```

	 id
	----
	(0 строк)

```sql
SELECT * FROM ap2;
```

	 id
	----
	(0 строк)

Убедимся что приоритет у схемы postgres выше, чем у схемы app.

Создадим в схеме postgres создадим таблицу ap1 (имя таблицы совпадает именем таблицы в схеме app).

Чтобы при SELECT запросе отличить таблицы - назовем столобец не id, a my_id.

```sql
CREATE TABLE postgres.ap1(my_id int PRIMARY KEY);
```

	CREATE TABLE

Выведем список таблиц

Обратите внимание, что схема для таблицы ap1 указана postgres. Все потому что в переменной search_path имя схемы postgres указано раньше, чем имя схемы app

```sql
\dt
```

	          Список отношений
	  Схема   | Имя |   Тип   | Владелец
	----------+-----+---------+----------
	 app      | ap2 | таблица | postgres
	 postgres | ap1 | таблица | postgres
	 postgres | ps1 | таблица | postgres
	 postgres | ps2 | таблица | postgres
	(4 строки)

Выведем содержимое таблицы app1 без указания схемы

Выводится таблица из схемы postgres. Так как ее схемы приоритет в переменной search_path выше

```sql
SELECT * FROM ap1;
```

	 my_id
	-------
	(0 строк)

Выведем таблицу app1 из схемы app

```sql
SELECT * FROM app.ap1;
```

	 id
	----
	(0 строк)